<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />

    <link rel="stylesheet" href="styles.css" />

    <title>Health App</title>
  </head>
  <body>
    <!--=============== HEADER ===============-->
    <header class="header" id="header">
      <nav class="nav container">
        <a href="index.html" class="nav-logo">Health</a>

        <div class="nav-menu" id="nav-menu">
          <ul class="nav-list">
            <li class="nav-item">
              <a href="tips.html" class="nav-link">
                <img src="Assets/tips-pink.png" />
                <span class="nav-name">Tips</span>
              </a>
            </li>

            <li class="nav-item">
              <a href="exercise.html" class="nav-link">
                <img src="Assets/exercise-pink.png" />
                <span class="nav-name">Exercise</span>
              </a>
            </li>

            <li class="nav-item">
              <a href="index.html" class="nav-link">
                <img src="Assets/calendar-pink.png" />
                <span class="nav-name">Calendar</span>
              </a>
            </li>

            <li class="nav-item">
              <a href="goals.html" class="nav-link">
                <img src="Assets/goals-pink.png" />
                <span class="nav-name">Goals</span>
              </a>
            </li>

            <li class="nav-item">
              <a href="profile.html" class="nav-link active-link">
                <img src="Assets/profile-pink.png" />
                <span class="nav-name">Profile</span>
              </a>
            </li>
          </ul>
        </div>
        <img src="Assets/strawberries.png" alt="" class="nav-img" />
      </nav>
    </header>

    <!--=============== ADD YOUR CODE BELOW HERE ===============-->
    <main class="content">
      <div class="profile-content">
        <!-- <h1 style="position: relative; left: 13.5rem; padding: 20px"> -->
        <h1>Profile</h1>
        <!-- <img
          src="Assets/strawberries.png"
          alt=""
          class="nav-img"
          style="
            width: 200px;
            height: 200px;
            position: absolute;
            left: 12.5rem;
            padding: 10px;
          " />
        <div
          id="display-name"
          style="
            width: 640px;
            position: relative;
            top: 250px;
            text-align: center;
            font-size: 2rem;
          "></div>
        <div
          id="display-sex"
          style="
            position: relative;
            top: 300px;
            left: 15rem;
            padding: 10px;
          "></div>
        <div
          id="display-age"
          style="
            position: relative;
            top: 300px;
            left: 15rem;
            padding: 10px;
          "></div>
        <button
          class="data-entry-btn add-button"
          onclick="window.location.href = 'editProfile.html';"
          style="position: relative; top: 350px; left: 220px">
          Edit Profile
        </button> -->

        <img src="Assets/strawberries.png" alt="" class="nav-img" />
        <div id="display-name"></div>
        <div id="display-sex"></div>
        <div id="display-age"></div>
        <button
          class="data-entry-btn add-button"
          onclick="window.location.href = 'editProfile.html';">
          Edit Profile
        </button>

        <chart>
          <canvas le width="600px" height="200px"></canvas>
          <draw-canvas-data-set
            style="
              width: fit-content;
              height: fit-content;
              padding: 5px 15px;
              margin: 5px;
              position: absolute;
              left: 618px;
              top: 160px;
              opacity: 0;
              transition: all 0.5s ease 0s;
              color: rgb(255, 255, 255);
              background: rgb(3, 169, 244);
            "></draw-canvas-data-set>
        </chart>
      </div>
    </main>

    <script>
      window.onload = function () {
        var profileName = localStorage.getItem("profileName");
        if (profileName == null) {
          profileName = "Straw B. Berry";
        }
        var profileSex = localStorage.getItem("profileSex");
        if (profileSex == null) {
          profileSex = "Female";
        }
        var profileAge = localStorage.getItem("profileAge");
        if (profileAge == null) {
          profileAge = 20;
        }
        document.getElementById("display-name").textContent = profileName;
        document.getElementById("display-sex").textContent =
          "Sex: " + profileSex;
        document.getElementById("display-age").textContent =
          "Age: " + profileAge;
      };

      // Script for weight graph creation
      c = document.querySelector("canvas[le]");
      h = c.height;
      w = c.width;
      ctx = c.getContext("2d");
      dataY = ["10/26", "10/27", "10/28", "10/29", "10/30", "10/31", "11/1"];
      dataX = [100, 150, 160, 250, 260, 300, 360];
      // dataX = [100, 101, 102, 101, 103, 103, 102];
      // un = Math.round(Math.max(...dataX)/15)
      un = Math.round((Math.max(...dataX) - Math.min(...dataX)) / 10);
      ys = (w - 40) / dataY.length;
      dataT = [];

      chartLine();
      diagram();
      data();
      draw();
      points();
      function diagram() {
        y = 60;
        x = 1;
        ctx.strokeStyle = "#a7a7a7";
        // while (y < w) {
        //   ctx.beginPath();
        //   ctx.moveTo(y, 0);
        //   ctx.lineTo(y, h - 30);
        //   ctx.stroke();
        //   y += 30;
        // }
        while (x < h - 30) {
          ctx.beginPath();
          ctx.moveTo(60, x);
          ctx.lineTo(w, x);
          ctx.stroke();
          x += 30;
        }
      }
      function chartLine() {
        ctx.strokeStyle = "#000";
        ctx.beginPath();
        ctx.moveTo(60, 0);
        ctx.lineTo(60, h - 30);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(w, h - 30);
        ctx.lineTo(60, h - 30);
        ctx.stroke();
      }

      function draw() {
        ctx.save();
        ctx.strokeStyle = "#03a9f4";
        ctx.lineWidth = 3;
        ctx.beginPath();
        // ctx.lineJoin = "round";
        y = 60;
        height = h - 30;
        line = 30;
        start = 30;
        // ctx.moveTo(60, h-30);
        for (data of dataX) {
          (max = Math.max(...dataX)), (test = 30);
          while (max > data) {
            max = max - 1;
            test += line / un;
          }
          ctx.lineTo(30 + y, test);
          x = 30;
          y += ys;
        }
        ctx.stroke();
        ctx.restore();
      }
      function points() {
        ctx.fillStyle = "#0b95d3";
        y = 60;
        height = h - 30;
        line = 30;
        start = 30;
        for (data of dataX) {
          (max = Math.max(...dataX)), (test = 30);
          while (max > data) {
            max = max - 1;
            test += line / un;
          }
          circle(30 + y, test);
          dataT.push({
            data:
              Math.round(test) +
              "," +
              Math.round(30 + y) +
              "," +
              Math.round(data),
          });
          x = 30;
          y += ys;
        }
        ctx.stroke();
      }
      function data() {
        y = 60;
        x = 30;
        n = Math.max(...dataX);
        for (ydata of dataY) {
          ctx.font = "20px Arial";
          ctx.fillText(ydata, y, h - 10);
          y += ys;
        }
        while (x < h - 30) {
          ctx.font = "20px Arial";
          ctx.fillText(n, 0, x + 5);
          n = n - un;
          x += 30;
        }
      }

      function circle(x, y) {
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, 2 * Math.PI);
        ctx.fill();
      }

      c.onmousemove = function (e) {
        for (let data of dataT) {
          for (const [key, value] of Object.entries(data)) {
            let dataG = value.split(","),
              lx = e.layerX,
              ly = e.layerY,
              dx = dataG[1],
              dy = dataG[0];
            if (
              range(dx - 10, Math.floor(dx) + 10).includes(lx) &&
              range(dy - 10, Math.floor(dy) + 10).includes(ly)
            ) {
              $("draw-canvas-data-set").innerHTML = dataG[2];
              $("draw-canvas-data-set").style.opacity = "1";
              $("draw-canvas-data-set").style.left = e.clientX + "px";
              $("draw-canvas-data-set").style.top = e.clientY + "px";
            }
            if (
              range(dx - 10, Math.floor(dx) + 10).includes(lx) &&
              !range(dy - 10, Math.floor(dy) + 10).includes(ly)
            ) {
              $("draw-canvas-data-set").style.opacity = "0";
            }
            lx = lx - 1;
            dx = dx - 1;
          }
        }
      };

      function range(start, end) {
        let range = [...Array(end + 1).keys()].filter(
          (value) => end >= value && start <= value
        );
        return range;
      }
      function $(object) {
        return document.querySelector(object);
      }
    </script>
  </body>
</html>
